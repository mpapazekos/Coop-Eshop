@model IEnumerable<CartDetails>

@{
    ViewData["Title"] = "CartDetails";
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
}

<h2>CartDetails</h2>

@*<div id="cartSummary">
        @await Component.InvokeAsync("CartSummary", new { userId = Model });
    </div>*@

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.SupplierProduct.Product.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SupplierProduct.Product.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SupplierProduct)
            </th>
            <th></th>
        </tr>
    </thead>
        <tbody>

            @foreach (var item in Model)
            {

                <tr id="row-@item.CartDetailsID">
                    <td>
                        @Html.DisplayFor(modelItem => item.SupplierProduct.Product.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.SupplierProduct.Product.Description)
                    </td>
                    <td>
                        <group class="btn-group">
                            <button class="subtractOne btn btn-warning" data-id="@item.CartDetailsID">-</button>
                            <button id="quantity-@item.CartDetailsID" class="btn btn-primary" style="background-color:white">
                                @Html.DisplayFor(modelItem => item.Quantity)
                            </button>
                            <button data-id="@item.CartDetailsID" class="addOne btn btn-success">+</button>
                        </group>
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.SupplierProduct.GetCurrentSalePrice)
                    </td>
                    <td>
                        <a class="cartRemove btn btn-danger" data-url="@Url.Action("RemoveFromCart", "Cart", new { detailsId = item.CartDetailsID })">Remove from Cart</a>
                    </td>
                </tr>
            }
        
           
            </tbody>
  
    </table>

@section Scripts{

    <script>
        $(function () {

            $(".subtractOne").on("click", function () {
                var id = $(this).attr("data-id");
                removeDetails(id);
            });

            let removeDetails = (id) => {
                $.ajax({

                    url: `api/CartDetails/subtract/${id}`,
                    contentType: "application/json",
                    method: "PUT",
                    success: function (data) {
                        if (data.quantity !== 0) {

                            $("#quantity-" + data.id)
                        }

                    }

                });
            }


        });
    </script>
}

